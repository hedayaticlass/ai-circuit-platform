{% load socialaccount %}
{% load account %}
{% load static %}
<!doctype html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ù†Ø¸Ø±Ø§Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† | AI Circuit Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
      html, body {
        overflow-x: hidden;
        overflow-y: auto;
        scroll-behavior: smooth;

        -webkit-overflow-scrolling: touch; /* Ø§Ø³Ú©Ø±ÙˆÙ„ Ø±ÙˆØ§Ù† Ø¯Ø± iOS */
      }

      /* ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ø±Ø§ÛŒ ÙˆØ¨â€ŒÚ©ÛŒØª (Safari, Chrome, Edge) */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1); /* Darker track */
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.4); /* Darker thumb */
        border-radius: 4px;
        transition: background 0.3s ease;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.6); /* Slightly lighter on hover */
      }

      /* ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ø±Ø§ÛŒ Firefox */
      * {
        scrollbar-width: thin;
        scrollbar-color: rgba(255, 255, 255, 0.4) rgba(255, 255, 255, 0.1); /* Darker colors */
      }

      .reviews-list-container {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        background: var(--bg-black);
      }

      .reviews-list-header {
        padding: 2rem 3rem;
        display: flex;
        justify-content: space-between;
        align-items: center;

        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        backdrop-filter: blur(20px);
        background: rgba(0, 0, 0, 0.8);
        border-bottom: 1px solid var(--stroke);
      }

      .reviews-list-logo {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .reviews-list-logo-icon {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid var(--stroke);
        display: flex;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(10px);
      }

      .reviews-list-logo-icon svg {
        filter: drop-shadow(0 0 3px rgba(255, 255, 255, 0.3));
      }

      .reviews-list-logo h1 {
        font-size: 24px;
        font-weight: 700;
        color: var(--white);
        margin: 0;
      }

      .reviews-list-nav {
        display: flex;
        gap: 1rem;
        align-items: center;
      }

      .btn-reviews-list {
        background: transparent;
        backdrop-filter: blur(10px);
        border: none;
        border-radius: 10px;
        color: var(--white-80);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        padding: 1px 20px;
        font-size: 14px;
        font-weight: 500;
        text-decoration: none;
      }

      .btn-reviews-list:hover {
        background: rgba(255, 255, 255, 0.05);
        color: var(--white);
        transform: translateY(-1px);
      }

      .reviews-list-main {
        flex: 1;
        padding: 8rem 2rem 4rem;
        max-width: 1200px;
        margin: 0 auto;
        width: 100%;
      }

      .reviews-list-hero {
        text-align: center;
        margin-bottom: 4rem;
      }

      .reviews-list-title {
        font-size: clamp(2.5rem, 5vw, 4rem);
        font-weight: 700;
        color: var(--white);
        margin-bottom: 1.5rem;
        line-height: 1.2;
        letter-spacing: -1px;
      }

      .reviews-list-subtitle {
        font-size: clamp(1.1rem, 2.5vw, 1.3rem);
        color: var(--white-70);
        margin-bottom: 3rem;
        line-height: 1.6;
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
      }

      .reviews-stats {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin-bottom: 3rem;
        flex-wrap: wrap;
      }

      .stat-card {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(20px);
        border: 1px solid var(--stroke);
        border-radius: 16px;
        padding: 2rem;
        text-align: center;
        min-width: 200px;
        transition: all 0.3s ease;
      }

      .stat-card:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: var(--stroke-hover);
        transform: translateY(-5px);
      }

      .stat-number {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--white);
        margin-bottom: 0.5rem;
      }

      .stat-label {
        font-size: 1rem;
        color: var(--white-60);
        font-weight: 500;
      }

      /* Progress Bar Styles for Ratings */
      .reviews-ratings-breakdown {
        width: 100%;
      }

      .rating-stats-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding: 1.5rem;
        background: rgba(255, 255, 255, 0.02);
        border-radius: 12px;
        border: 1px solid var(--stroke);
      }

      .rating-stat-main {
        text-align: center;
        flex: 1;
      }

      .rating-stat-main .stat-number {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--white);
        margin-bottom: 0.5rem;
      }

      .rating-stat-main .stat-label {
        font-size: 1rem;
        color: var(--white-70);
        font-weight: 500;
      }

      .rating-stat-secondary {
        text-align: center;
        flex: 1;
      }

      .rating-stat-secondary .stat-number {
        font-size: 1.8rem;
        font-weight: 600;
        color: var(--white-80);
        margin-bottom: 0.25rem;
      }

      .rating-stat-secondary .stat-label {
        font-size: 0.85rem;
        color: var(--white-60);
      }

      .rating-progress-bars {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .rating-progress-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 0.75rem 1rem;
        background: rgba(255, 255, 255, 0.01);
        border-radius: 8px;
        border: 1px solid var(--stroke);
        transition: all 0.3s ease;
      }

      .rating-progress-item:hover {
        background: rgba(255, 255, 255, 0.03);
        border-color: var(--stroke-hover);
        transform: translateX(5px);
      }

      .rating-stars {
        font-size: 1.1rem;
        color: var(--white-70);
        min-width: 80px;
        text-align: center;
        direction: ltr;
      }

      .rating-bar-container {
        flex: 1;
        height: 8px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
        overflow: hidden;
        position: relative;
      }

      .rating-bar {
        height: 100%;
        background: linear-gradient(90deg,
          #ffd700 0%,
          #ffed4e 25%,
          #44ff44 50%,
          #44ff44 75%,
          #ffd700 100%);
        background-size: 200% 100%;
        animation: ratingBarGlow 2s ease-in-out infinite;
        border-radius: 4px;
        transition: width 1.5s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
      }

      .rating-bar::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg,
          rgba(255, 255, 255, 0.3) 0%,
          rgba(255, 255, 255, 0.1) 50%,
          rgba(255, 255, 255, 0.3) 100%);
        animation: ratingBarShimmer 2s ease-in-out infinite;
        border-radius: inherit;
      }

      @keyframes ratingBarGlow {
        0%, 100% {
          background-position: 0% 50%;
          box-shadow: 0 0 5px rgba(255, 215, 0, 0.3);
        }
        50% {
          background-position: 100% 50%;
          box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }
      }

      @keyframes ratingBarShimmer {
        0%, 100% {
          opacity: 0;
          transform: translateX(-100%);
        }
        50% {
          opacity: 1;
          transform: translateX(0%);
        }
      }

      .rating-percentage {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--white);
        min-width: 45px;
        text-align: center;
      }

      .rating-count {
        font-size: 0.8rem;
        color: var(--white-50);
        min-width: 35px;
        text-align: center;
      }

      /* Special styling for 5-star rating */
      .rating-progress-item:first-child {
        background: rgba(255, 215, 0, 0.05);
        border-color: rgba(255, 215, 0, 0.2);
      }

      .rating-progress-item:first-child .rating-stars {
        color: #ffd700;
      }

      .rating-progress-item:first-child .rating-bar {
        background: linear-gradient(90deg, #ffd700, #ffed4e);
      }

      .reviews-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
      }

      .review-card {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(20px);
        border: 1px solid var(--stroke);
        border-radius: 16px;
        padding: 2rem;
        transition: all 0.3s ease;
        animation: fadeInUp 0.6s ease-out forwards;
        opacity: 0;
        transform: translateY(20px);
      }

      .review-card:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: var(--stroke-hover);
        transform: translateY(-5px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }

      .review-card:nth-child(1) { animation-delay: 0.1s; }
      .review-card:nth-child(2) { animation-delay: 0.2s; }
      .review-card:nth-child(3) { animation-delay: 0.3s; }
      .review-card:nth-child(4) { animation-delay: 0.4s; }
      .review-card:nth-child(5) { animation-delay: 0.5s; }

      @keyframes fadeInUp {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .review-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
      }

      .review-user {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .review-avatar {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid var(--stroke);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        font-weight: 600;
        color: var(--white-80);
        backdrop-filter: blur(10px);
      }

      .review-user-info h4 {
        font-size: 16px;
        font-weight: 600;
        color: var(--white);
        margin: 0;
        margin-bottom: 0.25rem;
      }

      .review-date {
        font-size: 12px;
        color: var(--white-50);
      }

      .review-rating {
        font-size: 1.25rem;
        direction: ltr;
        display: inline-block;
      }

      .review-comment {
        color: var(--white-80);
        line-height: 1.6;
        font-size: 14px;
        margin: 0;
      }

      .user-badge,
      .guest-badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 10px;
        font-weight: 500;
        margin-top: 4px;
      }

      .user-badge {
        background: rgba(68, 255, 68, 0.1);
        color: #44ff44;
        border: 1px solid rgba(68, 255, 68, 0.3);
      }

      .guest-badge {
        background: rgba(255, 136, 0, 0.1);
        color: #ff8800;
        border: 1px solid rgba(255, 136, 0, 0.3);
      }


      .review-image-container {
        margin: 1.5rem 0;
      }

      .image-loading {
        text-align: center;
        padding: 2rem;
        background: rgba(0, 0, 0, 0.4);
        border: 1px solid var(--stroke);
        border-radius: 12px;
      }

      .image-loading p {
        color: var(--white-60);
        margin-top: 1rem;
        font-size: 14px;
      }

      .review-image {
        background: rgba(0, 0, 0, 0.4);
        border: 1px solid var(--stroke);
        border-radius: 12px;
        overflow: hidden;
        padding: 1rem;
        text-align: center;
      }

      .image-header {
        margin-bottom: 1rem;
      }

      .image-label {
        color: var(--white-80);
        font-size: 13px;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
      }

      .rendered-image {
        max-width: 100%;
        max-height: 400px;
        border-radius: 8px;
        border: 1px solid var(--stroke);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        margin-bottom: 1rem;
      }

      .download-image-btn {
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid var(--stroke);
        border-radius: 8px;
        color: var(--white-80);
        padding: 0.5rem 1rem;
        font-size: 13px;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.2s ease;
      }

      .download-image-btn:hover {
        background: rgba(255, 255, 255, 0.15);
        border-color: var(--white-40);
        color: var(--white);
      }

      .no-reviews {
        text-align: center;
        padding: 4rem 2rem;
        background: rgba(255, 255, 255, 0.02);
        backdrop-filter: blur(20px);
        border: 1px solid var(--stroke);
        border-radius: 16px;
        margin-bottom: 3rem;
      }

      .no-reviews-icon {
        width: 80px;
        height: 80px;
        margin: 0 auto 1.5rem;
        color: var(--white-40);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .no-reviews h3 {
        font-size: 1.5rem;
        color: var(--white-70);
        margin-bottom: 1rem;
      }

      .no-reviews p {
        color: var(--white-50);
        line-height: 1.6;
      }

      .back-to-form-btn {
        background: transparent;
        border: 1px solid var(--stroke);
        color: var(--white-80);
        padding: 16px 32px;
        font-size: 16px;
        font-weight: 500;
        border-radius: 12px;
        text-decoration: none;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        margin-top: 2rem;
      }

      .back-to-form-btn:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: var(--stroke-hover);
        color: var(--white);
        transform: translateY(-1px);
      }

      .reviews-list-footer {
        padding: 2rem;
        text-align: center;
        background: rgba(10, 10, 10, 0.8);
        border-top: 1px solid var(--stroke);
        margin-top: 4rem;
      }

      .footer-content {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
      }

      .footer-text {
        color: var(--white-60);
        font-size: 0.9rem;
      }

      .footer-links {
        display: flex;
        gap: 2rem;
      }

      .footer-link {
        color: var(--white-60);
        text-decoration: none;
        font-size: 0.9rem;
        transition: color 0.3s ease;
      }

      .footer-link:hover {
        color: var(--white);
      }

      .loading {
        text-align: center;
        padding: 4rem;
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid rgba(255, 255, 255, 0.1);
        border-top: 3px solid var(--white);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      /* Responsive */
      @media (max-width: 768px) {
        .reviews-list-header {
          padding: 1.5rem 1rem;
        }

        .reviews-list-main {
          padding: 6rem 1rem 2rem;
        }

        .reviews-grid {
          grid-template-columns: 1fr;
          gap: 1.5rem;
        }

        .reviews-stats {
          gap: 1rem;
        }

        .stat-card {
          min-width: 150px;
          padding: 1.5rem;
        }

        .rendered-image {
          max-height: 250px;
        }

        .footer-content {
          flex-direction: column;
          text-align: center;
        }

        .footer-links {
          justify-content: center;
        }

        .rating-stats-header {
          flex-direction: column;
          gap: 1.5rem;
          padding: 1rem;
        }

        .rating-stat-main .stat-number {
          font-size: 2rem;
        }

        .rating-stat-secondary .stat-number {
          font-size: 1.5rem;
        }

        .rating-progress-item {
          flex-direction: column;
          gap: 0.5rem;
          align-items: flex-start;
          padding: 1rem;
        }

        .rating-stars {
          font-size: 1rem;
          min-width: auto;
          align-self: center;
        }

        .rating-bar-container {
          width: 100%;
          height: 10px;
        }

        .rating-percentage,
        .rating-count {
          font-size: 0.85rem;
          min-width: auto;
        }
      }

      /* Language-specific styles */
      html[lang="fa"] .reviews-list-container {
        direction: rtl;
      }

      html[lang="en"] .reviews-list-container {
        direction: ltr;
      }

      /* ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ø®ØµÙˆØµ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ú©ÙˆÚ†Ú© */
      @media (max-width: 480px) {
        .reviews-list-title {
          font-size: 2rem;
        }

        .reviews-stats {
          flex-direction: column;
          align-items: center;
        }

        .review-card {
          padding: 1.5rem;
        }

        .back-to-form-btn {
          width: 100%;
          max-width: 300px;
        }

        .reviews-stats-hero h3 {
          font-size: 1.6rem;
        }
      }

      /* Infinite scroll styles */
      .reviews-grid.infinite-scroll {
        position: relative;
      }

      .load-more-btn {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--stroke);
        color: var(--white-80);
        padding: 16px 32px;
        font-size: 16px;
        font-weight: 500;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: block;
        margin: 2rem auto;
      }

      .load-more-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        border-color: var(--stroke-hover);
        color: var(--white);
        transform: translateY(-1px);
      }

      .load-more-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }
    </style>
  </head>
  <body>
    <div class="reviews-list-container">
      <!-- Header -->
      <header class="reviews-list-header">
        <div class="reviews-list-logo">
          <div class="reviews-list-logo-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="-0.1 -0.1 20.2 10.2" width="40" height="20">
              <defs>
                <linearGradient id="navbarCircuitGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                  <stop offset="0%" style="stop-color:#ffffff;stop-opacity:0" />
                  <stop offset="50%" style="stop-color:#ffffff;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#ffffff;stop-opacity:0" />
                </linearGradient>
              </defs>
              <!-- Background static circuit -->
              <path d="M0 5 4 5Q5 5 5 4L5 1Q5 0 6 0L9 0Q10 0 10 1L10 9Q10 10 11 10L14 10Q15 10 15 9L15 6Q15 5 16 5L20 5"
                    stroke="rgba(255, 255, 255, 0.4)"
                    stroke-width="0.15"
                    fill="none"
                    stroke-linecap="round"
                    stroke-linejoin="round" />
              <!-- Animated flowing circuit -->
              <path d="M0 5 4 5Q5 5 5 4L5 1Q5 0 6 0L9 0Q10 0 10 1L10 9Q10 10 11 10L14 10Q15 10 15 9L15 6Q15 5 16 5L20 5"
                    stroke="url(#navbarCircuitGradient)"
                    stroke-width="0.3"
                    fill="none"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-dasharray="1,2"
                    pathLength="100">
                <animate attributeName="stroke-dashoffset"
                         values="0;-20"
                         dur="1.5s"
                         repeatCount="indefinite" />
                <animate attributeName="stroke-width"
                         values="0.3;0.4;0.3"
                         dur="2s"
                         repeatCount="indefinite" />
              </path>
            </svg>
          </div>
          <h1>á´„ÉªÊ€á´„á´œÉªá´› á´€Éª</h1>
        </div>
        <nav class="reviews-list-nav">
          <a href="{% url 'landing' %}" class="btn-reviews-list">Ø®Ø§Ù†Ù‡</a>
          <a href="{% url 'reviews_page' %}" class="btn-reviews-list">Ø«Ø¨Øª Ù†Ø¸Ø±</a>
          {% if user.is_authenticated %}
            <a href="{% url 'logout' %}" class="btn-reviews-list">Ø®Ø±ÙˆØ¬</a>
          {% else %}
            <a href="{% url 'login' %}" class="btn-reviews-list">ÙˆØ±ÙˆØ¯</a>
          {% endif %}
        </nav>
      </header>

      <!-- Main Content -->
      <main class="reviews-list-main">
        <div class="reviews-list-hero">
          <h1 class="reviews-list-title">Ù†Ø¸Ø±Ø§Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</h1>
          <p class="reviews-list-subtitle">
            ØªØ¬Ø±Ø¨ÛŒØ§Øª Ùˆ Ù†Ø¸Ø±Ø§Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Circuit AI Ø±Ø§ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†ÛŒØ¯.
            Ø§ÛŒÙ† Ù†Ø¸Ø±Ø§Øª ØªÙˆØ³Ø· ØªÛŒÙ… Ù…Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ùˆ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯.
          </p>
        </div>

        <!-- Reviews Stats -->
        <div class="reviews-stats-section">
          <div class="reviews-stats-hero">
            <h3>Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ</h3>
            <p>Ù†Ø¸Ø±Ø§Øª ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡ Ùˆ Ø¢Ù…Ø§Ø± Ø±Ø¶Ø§ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</p>
          </div>

          <div class="reviews-stats" id="reviewsStats">
            <div class="loading">
              <div class="loading-spinner"></div>
              <p>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø±...</p>
            </div>
          </div>
        </div>

        <!-- Reviews Grid -->
        <div class="reviews-grid" id="reviewsGrid">
          {% for review in reviews %}
            <div class="review-card">
            <div class="review-header">
              <div class="review-user">
                <div class="review-avatar">
                  {% if review.user %}
                    {{ review.user.username|slice:":1"|upper }}
                  {% else %}
                    {{ review.guest_name|slice:":1"|upper|default:"Ù…" }}
                  {% endif %}
                </div>
                <div class="review-user-info">
                  <h4>{{ review.author_name }}</h4>
                  <div class="review-date">{{ review.created_at|date:"j F Y" }}</div>
                  {% if review.user %}
                    <div class="user-badge">Ú©Ø§Ø±Ø¨Ø± Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡</div>
                  {% else %}
                    <div class="guest-badge">Ù…Ù‡Ù…Ø§Ù†</div>
                  {% endif %}
                </div>
              </div>
              <div class="review-rating">
                {% for i in "12345" %}
                  {% if forloop.counter <= review.rating %}
                    <span style="color: #ffd700;">â˜…</span>
                  {% else %}
                    <span style="color: rgba(255, 255, 255, 0.3);">â˜†</span>
                  {% endif %}
                {% endfor %}
              </div>
            </div>

            {% if review.chat_history_message_id %}
            <div class="review-image-container" data-message-id="{{ review.chat_history_message_id }}">
              <div class="image-loading">
                <div class="loading-spinner"></div>
                <p>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØµÙˆÛŒØ±...</p>
              </div>
              <div class="review-image" style="display: none;">
                <div class="image-header">
                  <span class="image-label">ğŸ–¼ï¸ ØªØµÙˆÛŒØ± Ù…Ø¯Ø§Ø± Ø§Ø² Ú†Øª: <span class="chat-name-display"></span></span>
                </div>
                <img class="rendered-image" alt="ØªØµÙˆÛŒØ± Ù…Ø¯Ø§Ø±" style="display: none;">
                <a class="download-image-btn" download="circuit.png" style="display: none;">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                  </svg>
                  Ø¯Ø§Ù†Ù„ÙˆØ¯ ØªØµÙˆÛŒØ±
                </a>
              </div>
            </div>
            {% endif %}

            {% if review.comment %}
            <p class="review-comment">{{ review.comment }}</p>
            {% endif %}
          </div>
          {% empty %}
          <div class="no-reviews">
            <div class="no-reviews-icon">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
              </svg>
            </div>
            <h3>Ù‡Ù†ÙˆØ² Ù†Ø¸Ø±ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</h3>
            <p>Ø§ÙˆÙ„ÛŒÙ† Ù†ÙØ±ÛŒ Ø¨Ø§Ø´ÛŒØ¯ Ú©Ù‡ Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Circuit AI Ø«Ø¨Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯!</p>
          </div>
          {% endfor %}
        </div>

        <div style="text-align: center;">
          <a href="{% url 'reviews_page' %}" class="back-to-form-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M15 18l-6-6 6-6"/>
            </svg>
            <span>Ø«Ø¨Øª Ù†Ø¸Ø± Ø¬Ø¯ÛŒØ¯</span>
          </a>
        </div>
      </main>

      <!-- Footer -->
      <footer class="reviews-list-footer">
        <div class="footer-content">
          <div class="footer-text" data-lang-key="copyright">
            Â© 2024 Circuit AI. ØªÙ…Ø§Ù… Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª.
          </div>
          <div class="footer-links">
            <a href="#" class="footer-link" data-lang-key="about-us">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</a>
            <a href="#" class="footer-link" data-lang-key="contact-us">ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§</a>
            <a href="#" class="footer-link" data-lang-key="privacy">Ø­Ø±ÛŒÙ… Ø®ØµÙˆØµÛŒ</a>
          </div>
        </div>
      </footer>
    </div>

    <style>
        :root {
            --bg-black: #000000;
            --bg-dark: #0a0a0a;
            --bg-darker: #050505;
            --white: #ffffff;
            --white-90: rgba(255, 255, 255, 0.9);
            --white-80: rgba(255, 255, 255, 0.8);
            --white-70: rgba(255, 255, 255, 0.7);
            --white-60: rgba(255, 255, 255, 0.6);
            --white-50: rgba(255, 255, 255, 0.5);
            --white-40: rgba(255, 255, 255, 0.4);
            --white-30: rgba(255, 255, 255, 0.3);
            --white-20: rgba(255, 255, 255, 0.2);
            --white-10: rgba(255, 255, 255, 0.1);
            --white-5: rgba(255, 255, 255, 0.05);
            --stroke: rgba(255, 255, 255, 0.15);
            --stroke-hover: rgba(255, 255, 255, 0.3);
            --glow: rgba(255, 255, 255, 0.1);
          }

          * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
          }

          body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Vazirmatn', 'IRANSans', sans-serif;
            background: var(--bg-black);
            color: var(--white);
            height: auto;
            min-height: 100vh;
            overflow-x: hidden;
            overflow-y: auto;
            direction: rtl;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            scroll-behavior: smooth;
          }
    </style>

    <script>
      // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø± Ù†Ø¸Ø±Ø§Øª
      async function loadReviewsStats() {
        try {
          const response = await fetch('{% url "reviews_stats" %}');
          const data = await response.json();

          // Ø§ÛŒØ¬Ø§Ø¯ progress barÙ‡Ø§ÛŒ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª
          const ratingBarsHtml = [5, 4, 3, 2, 1].map(rating => {
            const percentage = data.rating_percentages[rating] || 0;
            const count = data.rating_counts[rating] || 0;
            const stars = 'â˜…'.repeat(rating) + 'â˜†'.repeat(5 - rating);

            return `
              <div class="rating-progress-item">
                <div class="rating-stars">${stars}</div>
                <div class="rating-bar-container">
                  <div class="rating-bar" style="width: ${percentage}%"></div>
                </div>
                <div class="rating-percentage">${percentage}%</div>
                <div class="rating-count">(${count})</div>
              </div>
            `;
          }).join('');

          document.getElementById('reviewsStats').innerHTML = `
            <div class="reviews-ratings-breakdown">
              <div class="rating-stats-header">
                <div class="rating-stat-main">
                  <div class="stat-number">${data.average_rating}</div>
                  <div class="stat-label">Ù…ÛŒØ§Ù†Ú¯ÛŒÙ† Ø§Ù…ØªÛŒØ§Ø²</div>
                </div>
                <div class="rating-stat-secondary">
                  <div class="stat-number">${data.total_reviews}</div>
                  <div class="stat-label">Ú©Ù„ Ù†Ø¸Ø±Ø§Øª</div>
                </div>
              </div>
              <div class="rating-progress-bars">
                ${ratingBarsHtml}
              </div>
            </div>
          `;
        } catch (error) {
          console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø±:', error);
          document.getElementById('reviewsStats').innerHTML = `
            <div class="stat-card">
              <div class="stat-number">-</div>
              <div class="stat-label">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ</div>
            </div>
          `;
        }
      }

      // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¢Ù…Ø§Ø±
      loadReviewsStats();

      // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØµØ§ÙˆÛŒØ± Ø±Ù†Ø¯Ø± Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù†Ø¸Ø±Ø§Øª
      document.addEventListener('DOMContentLoaded', function() {
        const imageContainers = document.querySelectorAll('.review-image-container');

        imageContainers.forEach(container => {
          const messageId = container.dataset.messageId;
          const loadingDiv = container.querySelector('.image-loading');
          const imageDiv = container.querySelector('.review-image');
          const img = container.querySelector('.rendered-image');
          const downloadBtn = container.querySelector('.download-image-btn');

          if (messageId) {
            console.log('Loading image for message:', messageId);
            // Ø¯Ø±ÛŒØ§ÙØª Ú©Ø¯ Ù¾Ø§ÛŒØªÙˆÙ† Ø§Ø² Ù¾ÛŒØ§Ù…
            fetch(`/api/chat/history/message/${messageId}`)
              .then(response => response.json())
              .then(data => {
                console.log('Message data received:', data);

                // Ù†Ù…Ø§ÛŒØ´ Ù†Ø§Ù… Ú†Øª
                const chatNameDisplay = container.querySelector('.chat-name-display');
                if (chatNameDisplay && data.session_name) {
                  chatNameDisplay.textContent = data.session_name;
                } else if (chatNameDisplay) {
                  chatNameDisplay.textContent = 'Ú†Øª Ù†Ø§Ø´Ù†Ø§Ø³';
                }

                if (data.image_base64) {
                  console.log('Image already rendered, using cached image');
                  img.src = data.image_base64;
                  downloadBtn.href = data.image_base64;
                  downloadBtn.download = `circuit-${messageId}.png`;

                  loadingDiv.style.display = 'none';
                  imageDiv.style.display = 'block';
                  img.style.display = 'block';
                  downloadBtn.style.display = 'inline-flex';

                } else if (data.python_code) {
                  // Ø±Ù†Ø¯Ø± Ú©Ø±Ø¯Ù† Ú©Ø¯ Ù¾Ø§ÛŒØªÙˆÙ† Ù…Ø§Ù†Ù†Ø¯ reviews.html
                  console.log('Rendering image for message:', messageId);
                  fetch('/api/render-python-code/', {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json',
                      'X-CSRFToken': getCookie('csrftoken')
                    },
                    body: JSON.stringify({ python_code: data.python_code })
                  })
                  .then(response => response.json())
                  .then(renderData => {
                    if (renderData.image_base64) {
                      console.log('Successfully rendered image');
                      img.src = renderData.image_base64;
                      downloadBtn.href = renderData.image_base64;
                      downloadBtn.download = `circuit-${messageId}.png`;

                      loadingDiv.style.display = 'none';
                      imageDiv.style.display = 'block';
                      img.style.display = 'block';
                      downloadBtn.style.display = 'inline-flex';

                    } else {
                      console.error('Render API returned no image');
                      loadingDiv.innerHTML = '<p>Ú©Ø¯ Ù¾Ø§ÛŒØªÙˆÙ† Ù‚Ø§Ø¨Ù„ Ø±Ù†Ø¯Ø± Ù†ÛŒØ³Øª</p>';
                    }
                  })
                  .catch(error => {
                    console.error('Error rendering code:', error);
                    loadingDiv.innerHTML = '<p>Ø®Ø·Ø§ Ø¯Ø± Ø±Ù†Ø¯Ø± Ú©Ø±Ø¯Ù† ØªØµÙˆÛŒØ±</p>';
                  });
                } else {
                  console.log('No python code or image found for message:', messageId);
                  loadingDiv.innerHTML = '<p>Ú©Ø¯ Ù¾Ø§ÛŒØªÙˆÙ† ÛŒØ§ ØªØµÙˆÛŒØ± ÛŒØ§ÙØª Ù†Ø´Ø¯</p>';
                }
              })
              .catch(error => {
                console.error('Error loading message:', error);
                loadingDiv.innerHTML = '<p>Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØµÙˆÛŒØ±</p>';
              });
          }
        });

        // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù‚Ø§Ø¨Ù„ÛŒØª Ø¨Ø²Ø±Ú¯â€ŒÙ†Ù…Ø§ÛŒÛŒ ØªØµØ§ÙˆÛŒØ± Ø¯Ø± Ù„ÛŒØ³Øª Ù†Ø¸Ø±Ø§Øª
        const renderedImages = document.querySelectorAll('.rendered-image');
        renderedImages.forEach(img => {
          img.style.cursor = 'pointer';
          img.addEventListener('click', function() {
            // Ø§ÛŒØ¬Ø§Ø¯ modal Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ØªØµÙˆÛŒØ± Ø¨Ø²Ø±Ú¯
            const modal = document.createElement('div');
            modal.style.cssText = `
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.9);
              display: flex;
              align-items: center;
              justify-content: center;
              z-index: 10000;
              cursor: pointer;
            `;

            const modalImg = document.createElement('img');
            modalImg.src = this.src;
            modalImg.style.cssText = `
              max-width: 90%;
              max-height: 90%;
              object-fit: contain;
              border-radius: 12px;
              box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            `;

            modal.appendChild(modalImg);
            document.body.appendChild(modal);

            // Ø¨Ø³ØªÙ† modal Ø¨Ø§ Ú©Ù„ÛŒÚ©
            modal.addEventListener('click', function() {
              document.body.removeChild(modal);
            });

            // Ø¨Ø³ØªÙ† modal Ø¨Ø§ ESC
            document.addEventListener('keydown', function closeModal(e) {
              if (e.key === 'Escape') {
                if (document.body.contains(modal)) {
                  document.body.removeChild(modal);
                }
                document.removeEventListener('keydown', closeModal);
              }
            });
          });
        });
      });


      // ØªØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙØªÙ† CSRF token
      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
          const cookies = document.cookie.split(';');
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
            }
          }
        }
        return cookieValue;
      }

      // Smooth scrolling for anchor links
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          const target = document.querySelector(this.getAttribute('href'));
          if (target) {
            target.scrollIntoView({
              behavior: 'smooth',
              block: 'start'
            });
          }
        });
      });
    </script>
  </body>
</html>
