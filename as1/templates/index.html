<!doctype html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AI Circuit Generator | تولید مدار هوشمند</title>
    <link rel="stylesheet" href="/staticfiles/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  </head>
  <body>
    <div class="app-container{% if not user.is_authenticated %} login-page{% endif %}">
      {% if user.is_authenticated %}
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="sidebar-header">
          <div class="logo">
            <div class="logo-icon">⚡</div>
            <h2>Circuit AI</h2>
          </div>
          <div class="sidebar-header-actions">
            <button id="btnToggleSettings" class="btn-glass btn-icon" title="تنظیمات">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-settings-2"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19.875 6.27a2.225 2.225 0 0 1 1.125 1.948v7.284c0 .809 -.443 1.555 -1.158 1.948l-6.75 4.27a2.269 2.269 0 0 1 -2.184 0l-6.75 -4.27a2.225 2.225 0 0 1 -1.158 -1.948v-7.285c0 -.809 .443 -1.554 1.158 -1.947l6.75 -3.98a2.33 2.33 0 0 1 2.25 0l6.75 3.98h-.033z" /><path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" /></svg>
            </button>
            <button id="btnNewChat" class="btn-glass btn-icon" title="چت جدید">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="icon icon-tabler icons-tabler-filled icon-tabler-square-rounded-plus"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 2l.324 .001l.318 .004l.616 .017l.299 .013l.579 .034l.553 .046c4.785 .464 6.732 2.411 7.196 7.196l.046 .553l.034 .579c.005 .098 .01 .198 .013 .299l.017 .616l.005 .642l-.005 .642l-.017 .616l-.013 .299l-.034 .579l-.046 .553c-.464 4.785 -2.411 6.732 -7.196 7.196l-.553 .046l-.579 .034c-.098 .005 -.198 .01 -.299 .013l-.616 .017l-.642 .005l-.642 -.005l-.616 -.017l-.299 -.013l-.579 -.034l-.553 -.046c-4.785 -.464 -6.732 -2.411 -7.196 -7.196l-.046 -.553l-.034 -.579a28.058 28.058 0 0 1 -.013 -.299l-.017 -.616c-.003 -.21 -.005 -.424 -.005 -.642l.001 -.324l.004 -.318l.017 -.616l.013 -.299l.034 -.579l.046 -.553c.464 -4.785 2.411 -6.732 7.196 -7.196l.553 -.046l.579 -.034c.098 -.005 .198 -.01 .299 -.013l.616 -.017c.21 -.003 .424 -.005 .642 -.005zm0 6a1 1 0 0 0 -1 1v2h-2l-.117 .007a1 1 0 0 0 .117 1.993h2v2l.007 .117a1 1 0 0 0 1.993 -.117v-2h2l.117 -.007a1 1 0 0 0 -.117 -1.993h-2v-2l-.007 -.117a1 1 0 0 0 -.993 -.883z" fill="currentColor" stroke-width="0" /></svg>
            </button>
          </div>
        </div>

        <div class="sidebar-content">
          <div id="sidebarContentWrapper" class="sidebar-content-wrapper">
            <div id="settingsSection" class="settings-section">
              <h3 class="section-title">تنظیمات</h3>
              <div class="form-group">
                <label for="llmBaseUrl">Base URL</label>
                <input id="llmBaseUrl" type="text" class="input-glass" value="http://127.0.0.1:1234" placeholder="http://127.0.0.1:1234" />
              </div>
              <div class="form-group">
                <label for="llmModel">نام مدل</label>
                <input id="llmModel" type="text" class="input-glass" value="grok-3-reasoning-gemma3-4b-distilled-hf" placeholder="نام مدل" />
              </div>
              <div class="form-group">
                <label for="llmApiKey">API Key</label>
                <input id="llmApiKey" type="password" class="input-glass" placeholder="sk-... یا API Key محلی" />
                <small class="input-hint">برای OpenAI با sk- شروع می‌شود</small>
              </div>
              <div class="form-group">
                <label>کاربر:</label>
                <p>{{ user.username }}</p>
                <form action="{% url 'logout' %}" method="post" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn-glass" style="margin-top: 10px;">خروج</button>
                </form>
              </div>
            </div>

            <div id="historySection" class="history-section active">
              <h3 class="section-title">تاریخچه</h3>
              <div id="chatSessions" class="chat-sessions">
                <div class="session-item active" data-session="default">
                  <span class="session-name" contenteditable="false">چت جدید</span>
                  <div class="session-actions">
                    <button class="btn-edit-session" data-session="default" title="ویرایش نام">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                      </svg>
                    </button>
                    <button class="btn-delete-session" data-session="default" title="حذف">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                      </svg>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </aside>

      <!-- Main Chat Area -->
      <main class="chat-main">
        <div class="chat-header">
          <div class="header-left">
            <button id="btnToggleSidebar" class="btn-glass btn-icon" title="باز/بسته کردن منو">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="12" x2="21" y2="12"></line>
                <line x1="3" y1="6" x2="21" y2="6"></line>
                <line x1="3" y1="18" x2="21" y2="18"></line>
              </svg>
            </button>
            <div class="header-title">
              <h1 id="chatSessionTitle">چت جدید</h1>
              <p class="header-subtitle">مدار خود را با هوش مصنوعی طراحی کنید</p>
            </div>
          </div>
          <div class="header-actions">
            <button id="btnClearChat" class="btn-glass btn-icon" title="پاک کردن چت">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
            </button>
          </div>
        </div>

        <div id="chatMessages" class="chat-messages">
          <div class="welcome-message">
            <div class="welcome-icon">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path>
              </svg>
            </div>
            <h2>خوش آمدید</h2>
            <p>توضیح مدار خود را به فارسی بنویسید و من برای شما کد و تصویر مدار را تولید می‌کنم.</p>
            <div class="example-prompts">
              <div class="example-prompt glass-card" data-prompt="یک فیلتر RC پایین‌گذر با مقاومت 10k و خازن 10nF">
                <span>فیلتر RC پایین‌گذر</span>
              </div>
              <div class="example-prompt glass-card" data-prompt="یک تقویت‌کننده عملیاتی با فیدبک منفی">
                <span>تقویت‌کننده عملیاتی</span>
              </div>
              <div class="example-prompt glass-card" data-prompt="یک مدار نوسان‌ساز RC">
                <span>نوسان‌ساز RC</span>
              </div>
            </div>
          </div>
        </div>

        <div class="chat-input-container">
          <div class="input-wrapper glass-card">
            <textarea 
              id="chatInput" 
              placeholder="توضیح مدار خود را بنویسید..."
              rows="1"
            ></textarea>
            <button id="btnSend" class="btn-send" title="ارسال">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
              </svg>
            </button>
          </div>
        </div>
      </main>
      {% else %}
      <div class="login-container">
        <div class="login-form">
          <div class="logo">
            <div class="logo-icon">⚡</div>
            <h2 class="login-title">Circuit AI</h2>
          </div>
          <p class="header-subtitle" style="color: var(--white-60); font-size: 14px; margin-bottom: 30px; text-align: center;">مدار خود را با هوش مصنوعی طراحی کنید</p>

          {% if signup_form %}
            <form method="post" action="{% url 'signup' %}">
                {% csrf_token %}
                <div class="form-group">
                  <label for="{{ signup_form.username.id_for_label }}">نام کاربری</label>
                  <input type="text" name="username" id="{{ signup_form.username.id_for_label }}" class="input-glass" placeholder="نام کاربری خود را وارد کنید" required>
                </div>
                <div class="form-group">
                  <label for="{{ signup_form.email.id_for_label }}">ایمیل</label>
                  <input type="email" name="email" id="{{ signup_form.email.id_for_label }}" class="input-glass" placeholder="ایمیل خود را وارد کنید" required>
                </div>
                <div class="form-group">
                  <label for="{{ signup_form.password1.id_for_label }}">رمز عبور</label>
                  <input type="password" name="password1" id="{{ signup_form.password1.id_for_label }}" class="input-glass" placeholder="رمز عبور خود را وارد کنید" required>
                </div>
                <div class="form-group">
                  <label for="{{ signup_form.password2.id_for_label }}">تکرار رمز عبور</label>
                  <input type="password" name="password2" id="{{ signup_form.password2.id_for_label }}" class="input-glass" placeholder="رمز عبور را تکرار کنید" required>
                </div>
                <button type="submit" class="login-button">ثبت نام</button>
            </form>
            <div class="login-links">
              <span>حساب کاربری دارید؟</span>
              <a href="#" id="showLogin">وارد شوید</a>
            </div>
          {% elif login_form %}
            <form method="post" action="{% url 'login' %}">
                {% csrf_token %}
                <div class="form-group">
                  <label for="{{ login_form.username.id_for_label }}">نام کاربری یا ایمیل</label>
                  <input type="text" name="username" id="{{ login_form.username.id_for_label }}" class="input-glass" placeholder="نام کاربری یا ایمیل خود را وارد کنید" required>
                </div>
                <div class="form-group">
                  <label for="{{ login_form.password.id_for_label }}">رمز عبور</label>
                  <input type="password" name="password" id="{{ login_form.password.id_for_label }}" class="input-glass" placeholder="رمز عبور خود را وارد کنید" required>
                </div>
                {% if error_message %}
                    <p class="error-message">{{ error_message }}</p>
                {% endif %}
                <button type="submit" class="login-button">ورود</button>
            </form>
            <div class="login-links">
              <span>حساب کاربری ندارید؟</span>
              <a href="#" id="showSignup">ثبت نام کنید</a>
            </div>
          {% else %}
            <p style="color: var(--white-60); font-size: 16px; margin-bottom: 30px; text-align: center;">لطفاً وارد شوید یا ثبت نام کنید تا به چت دسترسی پیدا کنید.</p>
            <button id="mainShowLogin" class="login-button" style="margin-bottom: 15px;">ورود</button>
            <button id="mainShowSignup" class="login-button">ثبت نام</button>
          {% endif %}
        </div>
      </div>
      {% endif %}
    </div>

    <div id="toastContainer" class="toast-container"></div>

    <script src="/staticfiles/app.js"></script>
  </body>
</html>